!function(){"use strict";var e="https://sqexcel.up.railway.app";function r(){try{var e=localStorage.getItem("seeq_credentials");if(e){var r=JSON.parse(e),t=new Date(r.timestamp);if(((new Date).getTime()-t.getTime())/36e5<24)return r;localStorage.removeItem("seeq_credentials")}return null}catch(e){return null}}function t(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var n=new XMLHttpRequest,a="".concat(e).concat(r);if(n.open(t?"POST":"GET",a,!1),n.setRequestHeader("Content-Type","application/json"),t?n.send(JSON.stringify(t)):n.send(),200!==n.status)return{success:!1,error:"HTTP ".concat(n.status,": ").concat(n.statusText),responseText:n.responseText,url:a};try{return JSON.parse(n.responseText)}catch(e){return{success:!1,error:"Failed to parse response: ".concat(e.message),rawResponse:n.responseText}}}catch(t){return{success:!1,error:"Backend request failed: ".concat(t instanceof Error?t.message:"Unknown error"),details:t instanceof Error?t.stack:"No stack trace",url:"".concat(e).concat(r)}}}CustomFunctions.associate("PULL",function(e,n,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"points",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3;try{var i,c,u,l=e.flat().filter(function(e){return e&&""!==e.trim()});if(0===l.length)return[["Error: No sensor names provided"]];try{i=new Date(n),c=new Date(a)}catch(e){return[["Error: Invalid datetime format. Use ISO format: YYYY-MM-DDTHH:MM:SS"]]}if(isNaN(i.getTime())||isNaN(c.getTime()))return[["Error: Invalid datetime format. Use ISO format: YYYY-MM-DDTHH:MM:SS"]];if(i>=c)return[["Error: Start datetime must be before end datetime"]];if("grid"!==s&&"points"!==s)return[["Error: Mode must be 'grid' or 'points'"]];if("grid"===s){if(u=String(o),!/^(\d+)(min|h|d|s)$/.test(u))return[["Error: Invalid grid format. Use format like '15min', '1h', '1d', '30s'"]]}else{var d="number"==typeof o?o:parseInt(String(o));if(isNaN(d)||d<=0)return[["Error: Number of points must be a positive integer"]];var m=c.getTime()-i.getTime(),f=Math.floor(m/1e3),g=Math.floor(f/d);if(g<1)return[["Error: Time range too short for requested number of points. Try fewer points or a longer time range."],["Debug: Time range: ".concat(f,"s (").concat((f/3600).toFixed(2),"h), Points: ").concat(d)],["Debug: Start: ".concat(i.toISOString(),", End: ").concat(c.toISOString())]];u="".concat(g,"s")}var p=r();if(!p)return[["Error: Not authenticated to Seeq. Please use the SqExcel taskpane to authenticate first."]];var h=t("/api/seeq/sensor-data",{sensorNames:l,startDatetime:n,endDatetime:a,grid:u,url:p.url,accessKey:p.accessKey,password:p.password,authProvider:"Seeq",ignoreSslErrors:!1});if(h.success&&h.data&&h.data.length>0){var N=["Timestamp"].concat(h.data_columns||[]),S=h.data.map(function(e){var r=function(e){try{var r;if("string"==typeof e)r=new Date(e);else if(e instanceof Date)r=e;else{if("number"!=typeof e)return 0;r=new Date(e)}return isNaN(r.getTime())?0:r.getTime()/864e5+25569}catch(e){return 0}}(e.Timestamp||e.index||"N/A"),t=(h.data_columns||[]).map(function(r){return void 0!==e[r]?e[r]:"N/A"});return[r].concat(t)});return S.length>0&&(S[0][0]="Debug: Grid=".concat(u,", Points=").concat(o,", Actual rows=").concat(S.length,", TimeRange=").concat(timeRangeSeconds,"s")),[N].concat(S)}return h.error&&h.error.includes("Failed to fetch")||h.error.includes("NetworkError")?[["Backend server not running"],["Please start the backend server:"],["1. Open terminal in the backend folder"],["2. Run: npm install && npm start"],["3. Then use this function again"]]:[["No data returned"],["Error: "+(h.error||h.message||"Unknown error")],["Sensors: "+l.join(", ")],["Time Range: "+n+" to "+a]]}catch(e){return[["Error: "+(e instanceof Error?e.message:"Unknown error")]]}}),CustomFunctions.associate("SEARCH_SENSORS",function(e){try{var n=e.flat().filter(function(e){return e&&""!==e.trim()});if(0===n.length)return[["Error: No sensor names provided"]];var a=r();if(!a)return[["Error: Not authenticated to Seeq. Please use the SqExcel taskpane to authenticate first."]];var s=t("/api/seeq/search-sensors",{sensorNames:n,url:a.url,accessKey:a.accessKey,password:a.password,authProvider:"Seeq",ignoreSslErrors:!1});if(s.success&&s.search_results&&s.search_results.length>0){var o=s.search_results.map(function(e){return[e.Name||"N/A",e.ID||"Not Found",e["Datasource Name"]||"N/A",e["Value Unit Of Measure"]||"N/A",e.Description||"N/A"]});return[["Name","ID","Datasource Name","Value Unit Of Measure","Description"]].concat(o)}return s.error&&s.error.includes("Failed to fetch")||s.error.includes("NetworkError")?[["Backend server not running"]]:[["No search results returned"],["Error: "+(s.error||s.message||"Unknown error")],["Sensors: "+n.join(", ")]]}catch(e){return[["Error: "+(e instanceof Error?e.message:"Unknown error")]]}})}();
//# sourceMappingURL=functions.js.map