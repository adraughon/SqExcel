!function(){"use strict";var e="https://sqexcel.up.railway.app";function r(){try{var e=localStorage.getItem("seeq_credentials");if(e){var r=JSON.parse(e),t=new Date(r.timestamp);if(((new Date).getTime()-t.getTime())/36e5<24)return r;localStorage.removeItem("seeq_credentials")}return null}catch(e){return null}}function t(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var n=new XMLHttpRequest,s="".concat(e).concat(r);if(n.open(t?"POST":"GET",s,!1),n.setRequestHeader("Content-Type","application/json"),t?n.send(JSON.stringify(t)):n.send(),200!==n.status)return{success:!1,error:"HTTP ".concat(n.status,": ").concat(n.statusText),responseText:n.responseText,url:s};try{return JSON.parse(n.responseText)}catch(e){return{success:!1,error:"Failed to parse response: ".concat(e.message),rawResponse:n.responseText}}}catch(t){return{success:!1,error:"Backend request failed: ".concat(t instanceof Error?t.message:"Unknown error"),details:t instanceof Error?t.stack:"No stack trace",url:"".concat(e).concat(r)}}}CustomFunctions.associate("PULL",function(e,n,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"points",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3;try{var i=e.flat().filter(function(e){return e&&""!==e.trim()});if(0===i.length)return[["Error: No sensor names provided"]];var c,u=new Date(n),l=new Date(s);if(isNaN(u.getTime())||isNaN(l.getTime()))return[["Error: Invalid datetime format. Use ISO format: YYYY-MM-DDTHH:MM:SS"]];if(u>=l)return[["Error: Start datetime must be before end datetime"]];if("grid"!==a&&"points"!==a)return[["Error: Mode must be 'grid' or 'points'"]];if("grid"===a){if(c=String(o),!/^(\d+)(min|h|d|s)$/.test(c))return[["Error: Invalid grid format. Use format like '15min', '1h', '1d', '30s'"]]}else{var d="number"==typeof o?o:parseInt(String(o));if(isNaN(d)||d<=0)return[["Error: Number of points must be a positive integer"]];var m=l.getTime()-u.getTime(),f=Math.floor(m/1e3),p=Math.floor(f/d);if(p<1)return[["Error: Time range too short for requested number of points. Try fewer points or a longer time range."]];c="".concat(p,"s")}var g=r();if(!g)return[["Error: Not authenticated to Seeq. Please use the SqExcel taskpane to authenticate first."]];var h=t("/api/seeq/sensor-data",{sensorNames:i,startDatetime:n,endDatetime:s,grid:c,url:g.url,accessKey:g.accessKey,password:g.password,authProvider:"Seeq",ignoreSslErrors:!1});if(h.success&&h.data&&h.data.length>0){var N=["Timestamp"].concat(h.data_columns||[]),v=h.data.map(function(e){var r=function(e){try{var r;if("string"==typeof e)r=new Date(e);else if(e instanceof Date)r=e;else{if("number"!=typeof e)return 0;r=new Date(e)}return isNaN(r.getTime())?0:r.getTime()/864e5+25569}catch(e){return 0}}(e.Timestamp||e.index||"N/A"),t=(h.data_columns||[]).map(function(r){return void 0!==e[r]?e[r]:"N/A"});return[r].concat(t)});return[N].concat(v)}return h.error&&h.error.includes("Failed to fetch")||h.error.includes("NetworkError")?[["Backend server not running"],["Please start the backend server:"],["1. Open terminal in the backend folder"],["2. Run: npm install && npm start"],["3. Then use this function again"]]:[["No data returned"],["Error: "+(h.error||h.message||"Unknown error")],["Sensors: "+i.join(", ")],["Time Range: "+n+" to "+s]]}catch(e){return[["Error: "+(e instanceof Error?e.message:"Unknown error")]]}}),CustomFunctions.associate("SEARCH_SENSORS",function(e){try{var n=e.flat().filter(function(e){return e&&""!==e.trim()});if(0===n.length)return[["Error: No sensor names provided"]];var s=r();if(!s)return[["Error: Not authenticated to Seeq. Please use the SqExcel taskpane to authenticate first."]];var a=t("/api/seeq/search-sensors",{sensorNames:n,url:s.url,accessKey:s.accessKey,password:s.password,authProvider:"Seeq",ignoreSslErrors:!1});if(a.success&&a.search_results&&a.search_results.length>0){var o=a.search_results.map(function(e){return[e.Name||"N/A",e.ID||"Not Found",e["Datasource Name"]||"N/A",e["Value Unit Of Measure"]||"N/A",e.Description||"N/A"]});return[["Name","ID","Datasource Name","Value Unit Of Measure","Description"]].concat(o)}return a.error&&a.error.includes("Failed to fetch")||a.error.includes("NetworkError")?[["Backend server not running"]]:[["No search results returned"],["Error: "+(a.error||a.message||"Unknown error")],["Sensors: "+n.join(", ")]]}catch(e){return[["Error: "+(e instanceof Error?e.message:"Unknown error")]]}})}();
//# sourceMappingURL=functions.js.map