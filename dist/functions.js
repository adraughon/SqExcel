!function(){"use strict";var e="https://sqexcel.up.railway.app";function r(){try{var e=localStorage.getItem("seeq_credentials");if(e){var r=JSON.parse(e),t=new Date(r.timestamp);if(((new Date).getTime()-t.getTime())/36e5<24)return r;localStorage.removeItem("seeq_credentials")}return null}catch(e){return console.log("Could not get stored credentials from localStorage:",e),null}}function t(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var s=new XMLHttpRequest,n="".concat(e).concat(r);if(console.log("[DEBUG] Attempting to connect to: ".concat(n)),console.log("[DEBUG] Endpoint: ".concat(r)),console.log("[DEBUG] Data:",t),s.open(t?"POST":"GET",n,!1),s.setRequestHeader("Content-Type","application/json"),console.log("[DEBUG] Request opened, sending..."),t?s.send(JSON.stringify(t)):s.send(),console.log("[DEBUG] Response received - Status: ".concat(s.status,", StatusText: ").concat(s.statusText)),console.log("[DEBUG] Response headers:",s.getAllResponseHeaders()),console.log("[DEBUG] Response text:",s.responseText.substring(0,200)+"..."),200!==s.status)return console.log("[DEBUG] HTTP error: ".concat(s.status," - ").concat(s.statusText)),{success:!1,error:"HTTP ".concat(s.status,": ").concat(s.statusText),responseText:s.responseText,url:n};try{var o=JSON.parse(s.responseText);return console.log("[DEBUG] Successfully parsed response:",o),o}catch(e){return console.log("[DEBUG] Failed to parse response:",e),{success:!1,error:"Failed to parse response: ".concat(e.message),rawResponse:s.responseText}}}catch(t){return console.log("[DEBUG] Exception during request:",t),{success:!1,error:"Backend request failed: ".concat(t instanceof Error?t.message:"Unknown error"),details:t instanceof Error?t.stack:"No stack trace",url:"".concat(e).concat(r)}}}CustomFunctions.associate("PULL_SENSOR_DATA",function(e,s,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"15min";try{var a=e.flat().filter(function(e){return e&&""!==e.trim()});if(0===a.length)return[["Error: No sensor names provided"]];var c=new Date(s),i=new Date(n);if(isNaN(c.getTime())||isNaN(i.getTime()))return[["Error: Invalid datetime format. Use ISO format: YYYY-MM-DDTHH:MM:SS"]];if(c>=i)return[["Error: Start datetime must be before end datetime"]];if(!/^(\d+)(min|h|d|s)$/.test(o))return[["Error: Invalid grid format. Use format like '15min', '1h', '1d', '30s'"]];var u=r();if(!u)return[["Error: Not authenticated to Seeq. Please use the SqExcel taskpane to authenticate first."]];var l=t("/api/seeq/sensor-data",{sensorNames:a,startDatetime:s,endDatetime:n,grid:o,url:u.url,accessKey:u.accessKey,password:u.password,authProvider:"Seeq",ignoreSslErrors:!1});if(l.success&&l.data&&l.data.length>0){var d=["Timestamp"].concat(l.data_columns||[]),m=l.data.map(function(e){var r=function(e){try{var r;if("string"==typeof e)r=new Date(e);else if(e instanceof Date)r=e;else{if("number"!=typeof e)return 0;r=new Date(e)}return isNaN(r.getTime())?0:r.getTime()/864e5+25569}catch(e){return 0}}(e.Timestamp||e.index||"N/A"),t=(l.data_columns||[]).map(function(r){return void 0!==e[r]?e[r]:"N/A"});return[r].concat(t)});return[d].concat(m)}return l.error&&l.error.includes("Failed to fetch")||l.error.includes("NetworkError")?[["Backend server not running"],["Please start the backend server:"],["1. Open terminal in the backend folder"],["2. Run: npm install && npm start"],["3. Then use this function again"]]:[["No data returned"],["Error: "+(l.error||l.message||"Unknown error")],["Sensors: "+a.join(", ")],["Time Range: "+s+" to "+n]]}catch(e){return[["Error: "+(e instanceof Error?e.message:"Unknown error")]]}}),CustomFunctions.associate("SEARCH_SENSORS",function(e){try{var s=e.flat().filter(function(e){return e&&""!==e.trim()});if(0===s.length)return[["Error: No sensor names provided"]];var n=r();if(!n)return[["Error: Not authenticated to Seeq. Please use the SqExcel taskpane to authenticate first."]];var o=t("/api/seeq/search-sensors",{sensorNames:s,url:n.url,accessKey:n.accessKey,password:n.password,authProvider:"Seeq",ignoreSslErrors:!1});if(o.success&&o.search_results&&o.search_results.length>0){var a=o.search_results.map(function(e){return[e.Name||"N/A",e.ID||"Not Found",e["Datasource Name"]||"N/A",e["Value Unit Of Measure"]||"N/A",e.Description||"N/A"]});return[["Name","ID","Datasource Name","Value Unit Of Measure","Description"]].concat(a)}return o.error&&o.error.includes("Failed to fetch")||o.error.includes("NetworkError")?[["Backend server not running"]]:[["No search results returned"],["Error: "+(o.error||o.message||"Unknown error")],["Sensors: "+s.join(", ")]]}catch(e){return[["Error: "+(e instanceof Error?e.message:"Unknown error")]]}})}();
//# sourceMappingURL=functions.js.map