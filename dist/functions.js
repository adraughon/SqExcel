!function(){"use strict";var e="https://sqexcel.up.railway.app";function r(){try{var e=localStorage.getItem("seeq_credentials");if(e){var r=JSON.parse(e),t=new Date(r.timestamp);if(((new Date).getTime()-t.getTime())/36e5<24)return r;localStorage.removeItem("seeq_credentials")}return null}catch(e){return null}}function t(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var n=new XMLHttpRequest,a="".concat(e).concat(r);if(n.open(t?"POST":"GET",a,!1),n.setRequestHeader("Content-Type","application/json"),t?n.send(JSON.stringify(t)):n.send(),200!==n.status)return{success:!1,error:"HTTP ".concat(n.status,": ").concat(n.statusText),responseText:n.responseText,url:a};try{return JSON.parse(n.responseText)}catch(e){return{success:!1,error:"Failed to parse response: ".concat(e.message),rawResponse:n.responseText}}}catch(t){return{success:!1,error:"Backend request failed: ".concat(t instanceof Error?t.message:"Unknown error"),details:t instanceof Error?t.stack:"No stack trace",url:"".concat(e).concat(r)}}}CustomFunctions.associate("PULL_SENSOR_DATA",function(e,n,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"15min";try{var o=e.flat().filter(function(e){return e&&""!==e.trim()});if(0===o.length)return[["Error: No sensor names provided"]];var i=new Date(n),c=new Date(a);if(isNaN(i.getTime())||isNaN(c.getTime()))return[["Error: Invalid datetime format. Use ISO format: YYYY-MM-DDTHH:MM:SS"]];if(i>=c)return[["Error: Start datetime must be before end datetime"]];if(!/^(\d+)(min|h|d|s)$/.test(s))return[["Error: Invalid grid format. Use format like '15min', '1h', '1d', '30s'"]];var u=r();if(!u)return[["Error: Not authenticated to Seeq. Please use the SqExcel taskpane to authenticate first."]];var l=t("/api/seeq/sensor-data",{sensorNames:o,startDatetime:n,endDatetime:a,grid:s,url:u.url,accessKey:u.accessKey,password:u.password,authProvider:"Seeq",ignoreSslErrors:!1});if(l.success&&l.data&&l.data.length>0){var d=["Timestamp"].concat(l.data_columns||[]),m=l.data.map(function(e){var r=function(e){try{var r;if("string"==typeof e)r=new Date(e);else if(e instanceof Date)r=e;else{if("number"!=typeof e)return 0;r=new Date(e)}return isNaN(r.getTime())?0:r.getTime()/864e5+25569}catch(e){return 0}}(e.Timestamp||e.index||"N/A"),t=(l.data_columns||[]).map(function(r){return void 0!==e[r]?e[r]:"N/A"});return[r].concat(t)});return[d].concat(m)}return l.error&&l.error.includes("Failed to fetch")||l.error.includes("NetworkError")?[["Backend server not running"],["Please start the backend server:"],["1. Open terminal in the backend folder"],["2. Run: npm install && npm start"],["3. Then use this function again"]]:[["No data returned"],["Error: "+(l.error||l.message||"Unknown error")],["Sensors: "+o.join(", ")],["Time Range: "+n+" to "+a]]}catch(e){return[["Error: "+(e instanceof Error?e.message:"Unknown error")]]}}),CustomFunctions.associate("SEARCH_SENSORS",function(e){try{var n=e.flat().filter(function(e){return e&&""!==e.trim()});if(0===n.length)return[["Error: No sensor names provided"]];var a=r();if(!a)return[["Error: Not authenticated to Seeq. Please use the SqExcel taskpane to authenticate first."]];var s=t("/api/seeq/search-sensors",{sensorNames:n,url:a.url,accessKey:a.accessKey,password:a.password,authProvider:"Seeq",ignoreSslErrors:!1});if(s.success&&s.search_results&&s.search_results.length>0){var o=s.search_results.map(function(e){return[e.Name||"N/A",e.ID||"Not Found",e["Datasource Name"]||"N/A",e["Value Unit Of Measure"]||"N/A",e.Description||"N/A"]});return[["Name","ID","Datasource Name","Value Unit Of Measure","Description"]].concat(o)}return s.error&&s.error.includes("Failed to fetch")||s.error.includes("NetworkError")?[["Backend server not running"]]:[["No search results returned"],["Error: "+(s.error||s.message||"Unknown error")],["Sensors: "+n.join(", ")]]}catch(e){return[["Error: "+(e instanceof Error?e.message:"Unknown error")]]}})}();
//# sourceMappingURL=functions.js.map